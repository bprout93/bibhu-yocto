From aa8d3a8cc612ba87c0497275f58a2317a90fb1c4 Mon Sep 17 00:00:00 2001
From: Remi Collet <remi@php.net>
Date: Tue, 12 Jan 2016 13:52:27 +0100
Subject: [PATCH] fix the fix for bug #70976 (imagerotate)

Upstream-Status: Backport
https://github.com/php/php-src/commit/aa8d3a8cc612ba87c0497275f58a2317a90fb1c4

CVE: CVE-2016-1903
Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 ext/gd/libgd/gd_interpolation.c | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

Index: php-5.5.21/ext/gd/libgd/gd_interpolation.c
===================================================================
--- php-5.5.21.orig/ext/gd/libgd/gd_interpolation.c
+++ php-5.5.21/ext/gd/libgd/gd_interpolation.c
@@ -2162,7 +2162,7 @@ gdImagePtr gdImageRotateInterpolated(con
 	   images can be done at a later point.
 	*/
 	if (src->trueColor == 0) {
-		if (bgcolor >= 0) {
+		if (bgcolor < gdMaxColors) {
 			bgcolor =  gdTrueColorAlpha(src->red[bgcolor], src->green[bgcolor], src->blue[bgcolor], src->alpha[bgcolor]);
 		}
 		gdImagePaletteToTrueColor(src);
